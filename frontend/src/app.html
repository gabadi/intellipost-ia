<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%sveltekit.assets%/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#1e40af" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="IntelliPost AI" />
    <link rel="apple-touch-icon" href="%sveltekit.assets%/favicon.png" />
    <link rel="manifest" href="%sveltekit.assets%/manifest.json" />

    <!-- Critical CSS Inline for Fast FCP -->
    <style>
      /* Critical CSS will be inlined here during build */
      /* This is handled by the build process to reduce First Contentful Paint */
    </style>

    <!-- FOUC Prevention Script - Inline for immediate execution -->
    <script>
      (function () {
        // Prevent flash of unstyled content by initializing theme immediately
        const THEME_STORAGE_KEY = 'intellipost_theme';
        const FEATURE_DARK_MODE = true; // Match config.features.DARK_MODE

        if (!FEATURE_DARK_MODE) {
          document.documentElement.setAttribute('data-theme', 'light');
          document.documentElement.style.setProperty('--color-scheme', 'light');
          return;
        }

        // Get stored theme preference
        let storedTheme = 'auto';
        try {
          const stored = localStorage.getItem(THEME_STORAGE_KEY);
          if (stored && ['light', 'dark', 'auto'].includes(stored)) {
            storedTheme = stored;
          }
        } catch (error) {
          // localStorage unavailable, use default
        }

        // Determine effective theme
        const isSystemDark =
          window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const effectiveTheme =
          storedTheme === 'auto' ? (isSystemDark ? 'dark' : 'light') : storedTheme;

        // Apply theme immediately
        document.documentElement.setAttribute('data-theme', effectiveTheme);
        document.documentElement.style.setProperty('--color-scheme', effectiveTheme);

        // Update meta theme-color for mobile browsers
        const metaThemeColor = document.querySelector('meta[name="theme-color"]');
        if (metaThemeColor) {
          const colors = {
            light: '#1e40af', // Primary blue
            dark: '#1e293b', // Dark secondary
          };
          metaThemeColor.setAttribute('content', colors[effectiveTheme]);
        }

        // Mark theme as initialized after content loads
        document.addEventListener('DOMContentLoaded', function () {
          document.documentElement.classList.add('theme-initialized');
        });
      })();
    </script>

    %sveltekit.head%
  </head>
  <body data-sveltekit-preload-data="hover">
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>
